security:
   password_hashers:
      Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'

   providers:
      app_user_provider:
         entity:
            class: App\Entity\Usuario
            property: email

   role_hierarchy:
      ROLE_ADMIN: ROLE_USER
      ROLE_SUPER_ADMIN: [ROLE_USER, ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH]

   firewalls:
      dev:
         pattern: ^/(_(profiler|wdt)|css|images|js)/
         security: false

      # Swagger documentation - public access (must be before api firewall)
      api_doc:
         pattern: ^/api/doc
         security: false

      # API login routes - Only autenticar and olvido-Contrasenna are public, cerrar-sesion requires auth
      # Pattern must match /api/{lang}/login/{endpoint} where {lang} can be es|en
      # MUST BE BEFORE 'api' firewall to have priority
      api_login_public:
         pattern: ^/api/(es|en)/login/(autenticar|olvido-Contrasenna)
         security: false

      # Public user authentication routes - must be before main firewall
      usuario_login:
         pattern: ^/usuario/(autenticar|olvidoContrasenna)
         security: false

      # API firewall - Token authentication (includes /api/{lang}/login/cerrar-sesion)
      # This captures all /api routes except those matched by api_login_public above
      api:
         pattern: ^/api
         lazy: true
         provider: app_user_provider
         stateless: true
         custom_authenticators:
            - App\Security\TokenAuthenticator

      # Admin firewall - Form login authentication
      # Must include /admin, /check, and /logout in pattern for form_login and logout to work
      main:
         lazy: true
         pattern: ^/(admin|check|logout)
         provider: app_user_provider
         login_throttling: null
         form_login:
            login_path: /login
            check_path: /check
            username_parameter: _username
            password_parameter: _password
            remember_me: true
         logout:
            path: /logout
            target: /login
            invalidate_session: true
         remember_me:
            secret: '%kernel.secret%'
            lifetime: 604800 # 7 d√≠as
            path: /admin

   access_control:
      # Public routes (no authentication required) - must be first
      - { path: ^/login, roles: IS_AUTHENTICATED_ANONYMOUSLY }
      - { path: ^/logout, roles: PUBLIC_ACCESS }
      - { path: ^/check, roles: IS_AUTHENTICATED_ANONYMOUSLY }
      - { path: ^/usuario/autenticar, roles: IS_AUTHENTICATED_ANONYMOUSLY }
      - { path: ^/usuario/olvidoContrasenna, roles: IS_AUTHENTICATED_ANONYMOUSLY }

      # Swagger documentation - public access
      - { path: ^/api/doc, roles: PUBLIC_ACCESS }

      # API login autenticar and olvido-Contrasenna routes (public - no authentication required)
      # Pattern must match /api/{lang}/login/{endpoint} where {lang} can be es|en
      - { path: ^/api/(es|en)/login/autenticar, roles: IS_AUTHENTICATED_ANONYMOUSLY }
      - { path: ^/api/(es|en)/login/olvido-Contrasenna, roles: IS_AUTHENTICATED_ANONYMOUSLY }

      # API login cerrar-sesion route (requires authentication)
      - { path: ^/api/(es|en)/login/cerrar-sesion, roles: [ROLE_ADMIN, ROLE_USER] }

      # Admin routes require authentication
      - { path: ^/admin, roles: [ROLE_ADMIN, ROLE_USER] }

      # API routes require authentication
      - { path: ^/api, roles: [ROLE_ADMIN, ROLE_USER] }
